<div class="d-flex justify-content-between align-items-center mb-3">
  <h3>Detail Warga</h3>
  <a routerLink="/residents" class="btn btn-sm btn-outline-secondary">Kembali</a>
  </div>

<div class="alert alert-danger" *ngIf="error">{{ error }}</div>
<div class="text-center" *ngIf="loading">
  <div class="spinner-border text-primary"></div>
</div>

<div class="card" *ngIf="!loading && resident">
  <div class="card-body">
    <div class="row g-3">
      <div class="col-md-8">
        <div class="mb-2"><strong>Nama:</strong> {{ resident.FullName }}</div>
        <div class="mb-2"><strong>NIK:</strong> {{ resident.NationalIdNumber }}</div>
        <div class="mb-2"><strong>Blok:</strong> {{ resident.Blok }}</div>
        <div class="mb-2"><strong>No Telp:</strong> {{ resident.PhoneNumber || '-' }}</div>
        <div class="mb-2"><strong>Email:</strong> {{ resident.Email || '-' }}</div>
        <div class="mb-2">
          <strong>Status:</strong>
          <span class="badge"
            [ngClass]="{
              'bg-warning text-dark': resident.ApprovalStatus === 'PENDING' || resident.ApprovalStatus === 'DRAFT',
              'bg-success': resident.ApprovalStatus === 'APPROVED',
              'bg-danger': resident.ApprovalStatus === 'REJECTED'
            }">
            {{ resident.ApprovalStatus }}
          </span>
          <small class="text-muted ms-2" *ngIf="resident.ApprovalNote">Catatan: {{ resident.ApprovalNote }}</small>
        </div>
        <div class="mt-3">
          <h5>Anggota Keluarga</h5>
          <div class="table-responsive">
            <table class="table table-sm table-bordered">
              <thead>
                <tr>
                  <th>Nama</th>
                  <th>Tanggal Lahir</th>
                  <th>Gender</th>
                  <th>Relasi</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let m of resident.FamilyMembers">
                  <td>{{ m.FullName }}</td>
                  <td>{{ m.BirthDate | date:'dd MMM yyyy' }}</td>
                  <td>{{ m.Gender }}</td>
                  <td>{{ m.Relationship }}</td>
                </tr>
                <tr *ngIf="resident.FamilyMembers.length === 0">
                  <td colspan="4" class="text-center text-muted">Tidak ada data</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="mb-3">
          <strong>Foto Profil</strong>
          <div *ngIf="resident.PicPath; else noPic">
            <img [src]="fullUrl(resident.PicPath)" class="img-thumbnail d-block mt-2" style="max-height:240px" />
          </div>
          <ng-template #noPic><div class="text-muted">-</div></ng-template>
        </div>
        <div>
          <strong>Kartu Keluarga</strong>
          <div *ngIf="resident.KkDocumentPath; else noKk">
            <a [href]="fullUrl(resident.KkDocumentPath)" target="_blank" rel="noopener">Lihat dokumen</a>
          </div>
          <ng-template #noKk><div class="text-muted">-</div></ng-template>
        </div>
      </div>
    </div>
  </div>
</div>
