 <div class="d-flex justify-content-between align-items-center mb-3">
  <h3>Warga Kita</h3>
  <div class="d-flex align-items-center">
    <div class="me-3">
      <label class="form-label me-2 mb-0">Rows</label>
      <select class="form-select form-select-sm d-inline-block" style="width: auto;" [ngModel]="query.pageSize" (ngModelChange)="changePageSize($event)">
        <option *ngFor="let s of pageSizes" [value]="s">{{ s }}</option>
      </select>
    </div>
  </div>
</div>

<div class="card shadow-sm">
  <div class="card-body">
    <div class="alert alert-danger" *ngIf="error">{{ error }}</div>
    <div class="mb-3">
      <div class="row g-2">
        <div class="col-sm-4">
          <input type="text" class="form-control form-control-sm" placeholder="Cari nama" [(ngModel)]="query.name">
        </div>
        <div class="col-sm-3">
          <input type="text" class="form-control form-control-sm" placeholder="Cari blok" [(ngModel)]="query.blok">
        </div>
        <div class="col-sm-3">
          <select class="form-select form-select-sm" [(ngModel)]="query.status">
            <option value="">Semua Status</option>
            <option value="PENDING">PENDING</option>
            <option value="APPROVED">APPROVED</option>
            <option value="REJECTED">REJECTED</option>
          </select>
        </div>
        <div class="col-sm-2 d-flex gap-2">
          <button class="btn btn-sm btn-outline-secondary w-100" (click)="resetFilters()">Reset</button>
          <button class="btn btn-sm btn-primary w-100" (click)="applyFilters()">Filter</button>
        </div>
      </div>
    </div>

    <div class="text-center" *ngIf="loading">
      <div class="spinner-border text-primary"></div>
    </div>
    <div class="table-responsive" *ngIf="!loading">
      <table class="table table-striped align-middle">
        <thead class="table-light">
          <tr>
            <th>Blok</th>
            <th>Nama</th>
            <th>No Telepon</th>
            <th>Status</th>
            <th *ngIf="authService.hasRole('ADMIN')">Approval</th>
            <th *ngIf="authService.hasRole('ADMIN')" class="text-end">Aksi</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let r of residents">
            <td>{{ r.Blok }}</td>
            <td>{{ r.FullName }}</td>
            <td>{{ r.PhoneNumber || '-' }}</td>
            <td>
              <span class="badge" [ngClass]="{
                'bg-warning text-dark': r.ApprovalStatus === 'PENDING',
                'bg-success': r.ApprovalStatus === 'APPROVED',
                'bg-danger': r.ApprovalStatus === 'REJECTED'
              }">{{ r.ApprovalStatus }}</span>
            </td>
            <td *ngIf="authService.hasRole('ADMIN')">
              <ng-container *ngIf="r.ApprovalStatus === 'PENDING'; else noAct">
                <button class="btn btn-sm btn-outline-success me-2" (click)="approve(r.ResidentId)">Approve</button>
                <button class="btn btn-sm btn-outline-danger" (click)="reject(r.ResidentId)">Reject</button>
              </ng-container>
              <ng-template #noAct>-</ng-template>
            </td>
            <td class="text-end" *ngIf="authService.hasRole('ADMIN')">
              <a class="btn btn-sm btn-outline-primary" [routerLink]="['/residents', r.ResidentId]">Lihat</a>
            </td>
          </tr>
          <tr *ngIf="residents.length === 0">
            <td [attr.colspan]="authService.hasRole('ADMIN') ? 6 : 4" class="text-center text-muted">Belum ada data.</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="d-flex justify-content-between align-items-center" *ngIf="!loading">
      <div class="text-muted">
        Menampilkan
        {{ ((query.page||1)-1)*(query.pageSize||10)+ (residents.length?1:0) }} -
        {{ ((query.page||1)-1)*(query.pageSize||10) + residents.length }}
        dari {{ total }} data
      </div>
      <div class="btn-group">
        <button class="btn btn-outline-secondary btn-sm" (click)="prevPage()" [disabled]="(query.page||1) === 1">Prev</button>
        <span class="btn btn-sm btn-outline-secondary disabled">Hal {{ query.page || 1 }} / {{ totalPages }}</span>
        <button class="btn btn-outline-secondary btn-sm" (click)="nextPage()" [disabled]="(query.page||1) >= totalPages">Next</button>
      </div>
    </div>
  </div>
</div>
